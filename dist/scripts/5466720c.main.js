!function(){function a(a){this.$el=$(a),this._data=[],this._sequence=0,this._addRow(0),this._buildComponentChooser(),this._initEvents(),this.render()}var b=[{cid:"EMPTY",name:"Empty Cell",columns:1,viewHtml:'<div class="col-md-1 editable"></div>'},{cid:"TEXT",name:"Text",columns:4,viewHtml:'<label class="col-md-2 control-label">Email</label>    <div class="col-md-2">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Email</label>    <div class="col-md-2">      <input type="email" class="form-control" placeholder="Email" value="{{>value}}">    </div>'},{cid:"PASSWORD",name:"Password",columns:4,viewHtml:'<label class="col-md-2 control-label">Password</label>    <div class="col-md-2">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Password</label>    <div class="col-md-2">      <input type="password" class="form-control" placeholder="Password">    </div>'},{cid:"SELECT",name:"Select",columns:4,viewHtml:'<label class="col-md-2 control-label">Select</label>    <div class="col-md-2">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Select</label>    <div class="col-md-2">      <select class="form-control" placeholder="Select">        <option value=""></option>        <option value="1">Select 1</option>        <option value="2">Select 2</option>        <option value="3">Select 3</option>      </select>    </div>'},{cid:"HORIZONTAL_RADIO",name:"Horizontal Radio",columns:6,viewHtml:'<label class="col-md-2 control-label">Horizontal </label>    <div class="col-md-4">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Horizontal Radio</label>    <div class="col-md-4">      <label class="radio-inline">        <input type="radio" name="horizontalRadio" value="1">        Radio 1      </label>      <label class="radio-inline">        <input type="radio" name="horizontalRadio" value="2">        Radio 2      </label>    </div>'},{cid:"VERTICAL_RADIO",name:"Vertical Radio",columns:6,viewHtml:'<label class="col-md-2 control-label">Vertical Radio</label>    <div class="col-md-4">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Vertical Radio</label>    <div class="col-md-4">      <div class="radio">        <label>          <input type="radio" name="verticalRadio" value="1">          Radio 1        </label>      </div>      <div class="radio">        <label>          <input type="radio" name="verticalRadio" value="2">          Radio 2        </label>      </div>    </div>'},{cid:"HORIZONTAL_CHECKBOX",name:"Horizontal Checkbox",columns:6,viewHtml:'<label class="col-md-2 control-label">Horizontal Checkbox</label>    <div class="col-md-4">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Horizontal Checkbox</label>    <div class="col-md-4">      <label class="checkbox-inline">        <input type="checkbox" name="horizontalCheckbox" value="1">        Checkbox 1      </label>      <label class="checkbox-inline">        <input type="checkbox" name="horizontalCheckbox" value="2">        Checkbox 2      </label>    </div>'},{cid:"VERTICAL_CHECKBOX",name:"Vertical Checkbox",columns:6,viewHtml:'<label class="col-md-2 control-label">Vertical Checkbox</label>    <div class="col-md-4">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Vertical Checkbox</label>    <div class="col-md-4">      <div class="checkbox">        <label>          <input type="checkbox" name="verticalCheckbox" value="1">          Checkbox 1        </label>      </div>      <div class="checkbox">        <label>          <input type="checkbox" name="verticalCheckbox" value="2">          Checkbox 2        </label>      </div>    </div>'},{cid:"TEXTAREA",name:"Textarea",columns:6,viewHtml:'<label class="col-md-2 control-label">Textarea</label>    <div class="col-md-4">      <p class="form-control-static">{{>value}}</p>    </div>',editHtml:'<label class="col-md-2 control-label">Textarea</label>    <div class="col-md-4">      <textarea class="form-control" placeholder="textarea"></textarea>      </select>    </div>'}],c='<div class="modal fade">      <div class="modal-dialog">        <div class="modal-content">          <div class="modal-header">            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>            <h4 class="modal-title">Component Chooser</h4>          </div>          <div class="modal-body">            <div class="input-group">              <span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>              <input type="text" class="form-control" placeholder="Search">            </div>            <table class="table table-condensed component-table">              <thead>                <tr>                  <th>ID</th>                  <th>Name</th>                  <th>Columns</th>                  <th>State</th>                  <th></th>                </tr>              </thead>              <tbody></tbody>            </table>          </div>        </div>      </div>    </div>';a.prototype._buildComponentChooser=function(){var a=this;this._$modal=$(c).appendTo("body");var d=this._$modal.find(".component-table tbody");b.forEach(function(a){if("EMPTY"!==a.cid){var b=$("<tr></tr>").attr("data-cid",a.cid).appendTo(d);$("<td/>").text(a.cid).appendTo(b),$("<td/>").text(a.name).appendTo(b),$("<td/>").text(a.columns).appendTo(b);var c=$("<td/>").appendTo(b);a.editHtml&&($('<label><input type="radio" name="'+a.cid+'" value="edit"/> Edit</label>').appendTo(c),$("<span>&nbsp;</span>").appendTo(c)),a.viewHtml&&$('<label><input type="radio" name="'+a.cid+'" value="view"/> View</label>').appendTo(c),c.find('input[type="radio"]')[0].checked=!0,$('<td><a href="javascript:void(0)" data-cid="'+a.cid+'" class="component-choose-button">Select</a></td>').appendTo(b)}}),this._$modal.on("click",".component-choose-button",function(){a._$modal.modal("hide");var b=$(this).data("cid"),c=$(this).parents("tr").find('input[type="radio"]:checked').val(),d=a._findComponent(b);a._replaceContent(d,c)}),this._$modal.on("keyup","input",function(){var b=$(this).val().toLowerCase(),c=a._$modal.find("tr");c.each(function(a,c){var d=$(c).text().toLowerCase();-1!=d.indexOf(b)?$(c).show():$(c).hide()})})},a.prototype._initEvents=function(){var a=this;this.$el.on("click",".editable",function(){a._$modal.modal("show"),a._$modal.find('input[type="text"]').val(""),a._$modal.find("tr").show(),a._selectedId=$(this).data("dataid")}),this.$el.on("click",".delete-row-button",function(){var b=$(this).data("rowindex");a._data.splice(b,1),0===a._data.length&&a._addRow(0),a.render()}),this.$el.on("click",".insert-row-button",function(){var b=$(this).data("rowindex");a._addRow(b),a.render()}),this.$el.on("click",".add-row-button",function(){var b=$(this).data("rowindex");a._addRow(b),a.render()}),this.$el.on("click",".delete-cell-button",function(){var b=$(this).data("dataid");a._deleteCell(b),a.render()}),this.$el.on("dragenter",function(b){b.preventDefault(),b.stopPropagation(),a.$el.addClass("dragging-file")}),this.$el.on("dragover",function(b){b.preventDefault(),b.stopPropagation(),a.$el.addClass("dragging-file")}),this.$el.on("dragleave",function(b){b.preventDefault(),b.stopPropagation(),a.$el.removeClass("dragging-file")}),this.$el.on("drop",function(b){b.preventDefault(),b.stopPropagation(),a.$el.removeClass("dragging-file");var c=b.originalEvent.dataTransfer.files[0],d=new FileReader;d.onload=function(b){a["import"](b.target.result)},d.readAsText(c)})},a.prototype._deleteCell=function(a){var b=this._findIndex(a),c=this._data[b.rowIndex],d=c[b.cellIndex],e=this._findComponent(d.cid);c.splice(b.cellIndex,1);for(var f=0;f<e.columns;f++)c.splice(b.cellIndex,0,{id:this._nextSequence(),cid:"EMPTY",state:"view"})},a.prototype._findIndex=function(a){var b=null;return this._data.forEach(function(c,d){c.forEach(function(c,e){c.id===a&&(b={rowIndex:d,cellIndex:e})})}),b},a.prototype._isReplaceable=function(a,b){for(var c=0;c<a.columns;c++){var d=this._data[b.rowIndex][b.cellIndex+c];if(!d||"EMPTY"!==d.cid)return!1}return!0},a.prototype._replaceContent=function(a,b){var c=this._findIndex(this._selectedId);if(!this._isReplaceable(a,c))return void alert("配置するだけのスペースがありません");for(var d=this._data[c.rowIndex],e=0;e<a.columns;e++)d.splice(c.cellIndex,1);d.splice(c.cellIndex,0,{id:this._nextSequence(),cid:a.cid,state:b}),this.render()},a.prototype._findComponent=function(a){var c=null;return b.forEach(function(b){b.cid===a&&(c=b)}),c},a.prototype._nextSequence=function(){return++this._sequence},a.prototype._addRow=function(a){for(var b=[],c=0;12>c;c++)b.push({id:this._nextSequence(),cid:"EMPTY",state:"view"});this._data.splice(a,0,b)},a.prototype["import"]=function(a){var b=JSON.parse(a),c=0;b.forEach(function(a){a.forEach(function(a){c=Math.max(c,a.id)})}),this._selectedId=c,this._data=b,this.render()},a.prototype["export"]=function(){return JSON.stringify(this._data)},a.prototype.html=function(){var a=$("<div/>").html(this.$el.html());return a.find(".control").remove(),a.find("*[data-dataid]").removeAttr("data-dataid"),html_beautify(a.html())},a.prototype.render=function(){var a=this;this.$el.empty(),this._data.forEach(function(b,c){var d=$('<div class="row"></div>').appendTo(a.$el);b.forEach(function(b){var c,e=a._findComponent(b.cid);c=$.templates("edit"===b.state?e.editHtml:e.viewHtml);var f=c.render({value:"><HOG>EHOGE\nkaigyo"}),g=$(f).appendTo(d).first();g.attr("data-dataid",b.id),"EMPTY"!==e.cid&&$('<span class="alert-danger glyphicon glyphicon-remove delete-cell-button control"></span>').appendTo(g).attr("data-dataid",b.id)}),$('<span class="alert-danger delete-row-button control">Delete Row</span>').appendTo(d).attr("data-rowindex",c),$('<span class="alert-info glyphicon glyphicon-plus insert-row-button control"></span>').appendTo(d).attr("data-rowindex",c)}),$('<span class="alert-info glyphicon glyphicon-plus add-row-button control"></span>').appendTo(this.$el.find(".row").last()).attr("data-rowindex",this._data.length)},this.ContentDesigner=a}(this),function(){function a(a){this.$el=$(a),this._data=[],this._buildComponentChooser(),this._initEvents(),this.render()}var b=[{cid:"DETAIL",position:"left",type:"link",style:"btn-default",label:"Detail"},{cid:"LIST",position:"left",type:"link",style:"btn-default",label:"List"},{cid:"DELETE",position:"right",type:"button",style:"btn-danger",label:"Delete"},{cid:"EXCEL_UL",position:"right",type:"button",style:"btn-success",label:"Excel UL"},{cid:"EXCEL_DL",position:"right",type:"link",style:"btn-success",label:"Excel DL"},{cid:"SAVE",position:"right",type:"button",style:"btn-primary",label:"Save"}],c='<div class="modal fade">      <div class="modal-dialog">        <div class="modal-content">          <div class="modal-header">            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>            <h4 class="modal-title">Button Chooser</h4>          </div>          <div class="modal-body">            <table class="table table-condensed table-hover component-table">              <thead>                <tr>                  <th></th>                  <th>ID</th>                  <th>Label</th>                  <th>Style</th>                  <th>Position</th>                  <th>URL</th>                </tr>              </thead>              <tbody></tbody>            </table>          </div>        </div>      </div>    </div>';a.prototype._buildComponentChooser=function(){var a=this;this._$modal=$(c).appendTo("body");var d=this._$modal.find(".component-table tbody");b.forEach(function(a){var b=$('<tr class="button-row"/>').appendTo(d);$('<td><input type="checkbox" value="'+a.cid+'"></td>').appendTo(b),$("<td/>").text(a.cid).appendTo(b),$("<td/>").text(a.label).appendTo(b),$("<td/>").text(a.style).appendTo(b),$("<td/>").text(a.position).appendTo(b);var c=$("<td/>").appendTo(b);"link"===a.type&&$('<input type="text" class="url"/>').appendTo(c)}),this._$modal.on("click","tr.button-row",function(b){if("input"!==b.target.tagName.toLowerCase()){var c=$(this).find('input[type="checkbox"]')[0];c.checked=!c.checked,a._refreshButtons()}}),this._$modal.on("change","input",function(){a._refreshButtons()})},a.prototype._refreshButtons=function(){var a=[];this._$modal.find("tbody tr").each(function(b,c){var d={},e=$(c).find('input[type="checkbox"]');d.cid=e.val(),d.url=$(c).find('input[type="text"].url').val(),e[0].checked&&a.push(d)}),this._data=a,this.render()},a.prototype._initEvents=function(){var a=this;this.$el.on("click",".edit-button",function(){a._$modal.modal("show")})},a.prototype._findComponent=function(a){var c=null;return b.forEach(function(b){b.cid===a&&(c=b)}),c},a.prototype.render=function(){var a=this;this.$el.empty(),$('<button class="btn btn-default edit-button">Edit</button>').appendTo(this.$el);var b=$("<div/>").addClass("action-container").appendTo(this.$el),c=$('<div class="left-actions"/>').appendTo(b),d=$('<div class="right-actions"/>').appendTo(b);this._data.forEach(function(b){var e,f=a._findComponent(b.cid);"link"===f.type?(e=$('<a class="btn"/>').addClass(f.style).text(f.label),e.attr("href",b.url)):"button"===f.type&&(e=$('<button class="btn"/>').addClass(f.style).text(f.label)),"left"===f.position?c.append(e):"right"===f.position&&d.append(e)})},this.ActionDesigner=a}(this),function(){var a='<div class="modal fade">      <div class="modal-dialog">        <div class="modal-content">          <div class="modal-body">            <div class="container-fluid">              <div class="row">                <div class="col-md-12">                  <textarea class="form-control" rows="15"></textarea>                </div>              </div>            </div>          </div>          <div class="modal-footer">            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>            <button id="import-apply" type="button" class="btn btn-primary">Import</button>          </div>        </div>      </div>    </div>',b=new ContentDesigner($(".content-designer")),c=(new ActionDesigner($(".action-designer")),$(a).appendTo("body")),d=c.find("textarea");$("#export-html").click(function(){$(b.html());d.val(b.html()),c.find(".modal-footer").hide(),c.modal("show")}),$("#export").click(function(){d.val(b["export"]()),c.find(".modal-footer").hide(),c.modal("show")}),$("#import").click(function(){c.find(".modal-footer").show(),c.modal("show")}),$("body").on("click","#import-apply",function(){var a=d.val();b["import"](a),c.modal("hide")})}();